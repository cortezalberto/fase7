# ============================================================================
# Prometheus Configuration for AI-Native MVP
# ============================================================================
# Updated: Cortez94 - January 2026
# - Added LLM provider metrics
# - Updated version labels
# - Enhanced scrape configurations
# ============================================================================

global:
  # Scrape interval (default: 15s)
  scrape_interval: 15s

  # Timeout for scrapes (default: 10s)
  scrape_timeout: 10s

  # Evaluation interval for rules (default: 15s)
  evaluation_interval: 15s

  # External labels for all metrics/alerts
  external_labels:
    environment: 'development'
    cluster: 'ai-native-mvp'
    project: 'ai-native-backend'

# ============================================================================
# Alertmanager Configuration
# ============================================================================
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - 'alertmanager:9093'

# ============================================================================
# Alert Rules
# ============================================================================
rule_files:
  - '/etc/prometheus/alerts/*.yml'

# ============================================================================
# Scrape Configuration
# ============================================================================
scrape_configs:
  # ========================================================================
  # Prometheus Self-Monitoring
  # ========================================================================
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'

  # ========================================================================
  # AI-Native MVP API Backend
  # ========================================================================
  - job_name: 'ai-native-api'
    scrape_interval: 15s
    scrape_timeout: 5s
    metrics_path: '/metrics'
    scheme: 'http'

    static_configs:
      - targets:
          - 'api:8000'            # Docker Compose service name
          # - 'localhost:8000'    # Local development
        labels:
          service: 'ai-native-api'
          component: 'backend'
          version: '2.0.0'

  # ========================================================================
  # PostgreSQL Database (via postgres-exporter)
  # ========================================================================
  - job_name: 'postgresql'
    scrape_interval: 30s
    scrape_timeout: 10s
    static_configs:
      - targets: ['postgres-exporter:9187']
        labels:
          service: 'postgresql'
          database: 'ai_native'

  # ========================================================================
  # Redis Cache (via redis-exporter)
  # ========================================================================
  - job_name: 'redis'
    scrape_interval: 15s
    scrape_timeout: 5s
    static_configs:
      - targets: ['redis-exporter:9121']
        labels:
          service: 'redis'
          cache: 'llm-cache'

  # ========================================================================
  # Alertmanager
  # ========================================================================
  - job_name: 'alertmanager'
    scrape_interval: 30s
    static_configs:
      - targets: ['alertmanager:9093']
        labels:
          service: 'alertmanager'

  # ========================================================================
  # Node Exporter (optional - host metrics)
  # ========================================================================
  # Uncomment if using node-exporter
  # - job_name: 'node'
  #   static_configs:
  #     - targets: ['node-exporter:9100']
  #       labels:
  #         service: 'node-exporter'

# ============================================================================
# Useful Queries
# ============================================================================
#
# AI-Native API Metrics:
#   - Total interactions: ai_native_interactions_total
#   - Interaction rate: rate(ai_native_interactions_total[1m])
#   - LLM latency avg: avg(ai_native_llm_call_duration_seconds)
#   - LLM latency p99: histogram_quantile(0.99, ai_native_llm_call_duration_seconds_bucket)
#   - Cache hit rate: ai_native_cache_hit_rate_percent
#   - DB pool usage: ai_native_database_pool_checked_out / ai_native_database_pool_size
#   - Critical risks: ai_native_risks_detected_total{risk_level="CRITICAL"}
#   - Governance blocks: rate(ai_native_governance_blocks_total[5m])
#
# PostgreSQL Metrics (via postgres-exporter):
#   - Active connections: pg_stat_activity_count
#   - Database size: pg_database_size_bytes
#   - Transactions/sec: rate(pg_stat_database_xact_commit[1m])
#   - Cache hit ratio: pg_stat_database_blks_hit / (pg_stat_database_blks_hit + pg_stat_database_blks_read)
#   - Deadlocks: pg_stat_database_deadlocks
#   - Slow queries: pg_stat_statements_calls (requires pg_stat_statements extension)
#
# Redis Metrics (via redis-exporter):
#   - Connected clients: redis_connected_clients
#   - Memory usage: redis_memory_used_bytes
#   - Hit rate: redis_keyspace_hits_total / (redis_keyspace_hits_total + redis_keyspace_misses_total)
#   - Commands/sec: rate(redis_commands_processed_total[1m])
#   - Evicted keys: redis_evicted_keys_total
#   - Blocked clients: redis_blocked_clients
#
# ============================================================================
