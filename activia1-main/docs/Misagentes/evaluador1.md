# E-IA-Proc: Evaluador de Procesos Cognitivos

## DocumentaciÃ³n TÃ©cnica Completa

---

## 1. IntroducciÃ³n y PropÃ³sito

### 1.1 Â¿QuÃ© es E-IA-Proc?

El **E-IA-Proc** (Evaluador IA de Procesos Cognitivos) es el **Submodelo 2** del ecosistema AI-Native. Su propÃ³sito fundamental es:

> **Analizar, reconstruir y evaluar el PROCESO cognitivo hÃ­brido humano-IA que condujo a una soluciÃ³n tÃ©cnica.**

A diferencia de los evaluadores tradicionales que califican solo el producto final (el cÃ³digo), E-IA-Proc evalÃºa **CÃ“MO** el estudiante llegÃ³ a la soluciÃ³n:
- Â¿PlanificÃ³ antes de codificar?
- Â¿JustificÃ³ sus decisiones?
- Â¿Se autocorrigiÃ³ cuando encontrÃ³ errores?
- Â¿UsÃ³ la IA como herramienta o como muleta?

### 1.2 Principio Fundamental

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  E-IA-Proc NO CALIFICA NI APRUEBA                                              â•‘
â•‘  Solo ANALIZA y GENERA EVIDENCIA para que el docente tome la decisiÃ³n final   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

Este principio es crÃ­tico: el evaluador proporciona anÃ¡lisis objetivo y evidencia trazable, pero la evaluaciÃ³n final siempre es responsabilidad del docente humano.

### 1.3 Referencia TeÃ³rica

El E-IA-Proc se basa en el modelo de **autorregulaciÃ³n de Zimmerman (2002)**, que propone tres fases cÃ­clicas del aprendizaje:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CICLO DE ZIMMERMAN                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚ PLANIFICACIÃ“Nâ”‚â”€â”€â”€â–ºâ”‚  EJECUCIÃ“N   â”‚â”€â”€â”€â–ºâ”‚  REFLEXIÃ“N   â”‚   â”‚
â”‚    â”‚  (Forethought)â”‚    â”‚ (Performance)â”‚    â”‚(Self-Reflect)â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â–²                                        â”‚           â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. UbicaciÃ³n en el Ecosistema

### 2.1 Archivo Principal

```
backend/agents/evaluator.py
```

### 2.2 Archivos Relacionados

| Archivo | PropÃ³sito |
|---------|-----------|
| `backend/models/evaluation.py` | Modelos Pydantic para evaluaciÃ³n |
| `backend/api/routers/evaluations.py` | Endpoints REST de evaluaciÃ³n |
| `backend/api/schemas/evaluation.py` | Schemas de request/response |
| `backend/database/models.py` | Modelo ORM `EvaluationDB` |
| `backend/database/repositories.py` | `EvaluationRepository` |
| `backend/core/response_generator.py` | IntegraciÃ³n con ResponseGenerator |
| `backend/core/ai_gateway.py` | Orquestador principal |

### 2.3 PosiciÃ³n en la Arquitectura

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚             AIGateway                    â”‚
                    â”‚         (Orquestador STATELESS)          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                          â”‚                          â”‚
            â–¼                          â–¼                          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   T-IA-Cog    â”‚         â”‚  E-IA-Proc    â”‚         â”‚   S-IA-X      â”‚
    â”‚    (Tutor)    â”‚         â”‚  (EVALUADOR)  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚ (Simuladores) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                          â”‚                          â”‚
            â”‚                          â”‚                          â”‚
            â–¼                          â–¼                          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                          TC-N4                                     â”‚
    â”‚              (Sistema de Trazabilidad Cognitiva)                   â”‚
    â”‚                                                                     â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
    â”‚   â”‚   N1    â”‚   â”‚   N2    â”‚   â”‚   N3    â”‚   â”‚   N4    â”‚          â”‚
    â”‚   â”‚Superfic.â”‚   â”‚ TÃ©cnico â”‚   â”‚Interacc.â”‚   â”‚Cognitivoâ”‚          â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                        PostgreSQL                                  â”‚
    â”‚     evaluations â”‚ cognitive_traces â”‚ sessions â”‚ trace_sequences   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Estructura de la Clase Principal

### 3.1 Clase `EvaluadorProcesosAgent`

```python
class EvaluadorProcesosAgent:
    """
    E-IA-Proc: Evaluador de Procesos Cognitivos

    Funciones:
    1. AnÃ¡lisis de razonamiento (camino cognitivo)
    2. DetecciÃ³n de errores conceptuales y epistemolÃ³gicos
    3. EvaluaciÃ³n de autorregulaciÃ³n (Zimmerman, 2002)
    4. ComparaciÃ³n y coherencia evolutiva vÃ­a Git
    5. GeneraciÃ³n del Informe de EvaluaciÃ³n Cognitiva (IEC)

    NO califica ni aprueba - solo analiza y genera evidencia
    """
```

### 3.2 Constructor

```python
def __init__(self, llm_provider=None, config: Optional[Dict[str, Any]] = None):
    self.llm_provider = llm_provider  # Proveedor de LLM (Ollama/Phi-3)
    self.config = config or {}         # ConfiguraciÃ³n adicional
```

**InyecciÃ³n de Dependencias:**
- El `llm_provider` se inyecta desde el `AIGateway`
- Permite usar diferentes modelos (Phi-3, Llama2, GPT-4) segÃºn configuraciÃ³n

---

## 4. Flujo de EvaluaciÃ³n Principal

### 4.1 MÃ©todo Central: `evaluate_process()`

```python
def evaluate_process(
    self,
    trace_sequence: TraceSequence,  # Secuencia de trazas N4
    code_evolution: Optional[List[Dict[str, Any]]] = None  # Commits Git
) -> EvaluationReport:
```

### 4.2 Pipeline de EvaluaciÃ³n (7 Fases)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PIPELINE DE EVALUACIÃ“N E-IA-Proc                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ENTRADA: TraceSequence (secuencia de trazas cognitivas N4)               â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ FASE 1: AnÃ¡lisis del Razonamiento                                    â”‚  â”‚
â”‚   â”‚ _analyze_reasoning(trace_sequence)                                   â”‚  â”‚
â”‚   â”‚   â€¢ Reconstruir camino cognitivo                                     â”‚  â”‚
â”‚   â”‚   â€¢ Identificar fases completadas                                    â”‚  â”‚
â”‚   â”‚   â€¢ Contar cambios de estrategia, autocorrecciones                   â”‚  â”‚
â”‚   â”‚   â€¢ Calcular coherencia entre decisiones y justificaciones           â”‚  â”‚
â”‚   â”‚   â€¢ Detectar errores conceptuales y falacias lÃ³gicas                 â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                             â”‚
â”‚                               â–¼                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ FASE 2: AnÃ¡lisis Git (opcional)                                      â”‚  â”‚
â”‚   â”‚ _analyze_git_evolution(code_evolution, trace_sequence)               â”‚  â”‚
â”‚   â”‚   â€¢ Evaluar calidad de mensajes de commit                            â”‚  â”‚
â”‚   â”‚   â€¢ Detectar "saltos sospechosos" (cÃ³digo copiado sin entender)      â”‚  â”‚
â”‚   â”‚   â€¢ Verificar coherencia de evoluciÃ³n                                 â”‚  â”‚
â”‚   â”‚   â€¢ Vincular commits a trazas N4                                     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                             â”‚
â”‚                               â–¼                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ FASE 3: CÃ¡lculo de Dependencia de IA                                 â”‚  â”‚
â”‚   â”‚ _calculate_ai_dependency(trace_sequence)                             â”‚  â”‚
â”‚   â”‚   â€¢ Obtener ai_dependency_score de la secuencia                      â”‚  â”‚
â”‚   â”‚   â€¢ Escala 0.0 (autÃ³nomo) a 1.0 (dependencia total)                  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                             â”‚
â”‚                               â–¼                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ FASE 4: IdentificaciÃ³n de Riesgos Cognitivos                         â”‚  â”‚
â”‚   â”‚ _identify_cognitive_risks(trace_sequence, reasoning)                 â”‚  â”‚
â”‚   â”‚   â€¢ Sin cambios de estrategia â†’ posible inflexibilidad               â”‚  â”‚
â”‚   â”‚   â€¢ Sin autocorrecciones â†’ falta de revisiÃ³n crÃ­tica                 â”‚  â”‚
â”‚   â”‚   â€¢ PlanificaciÃ³n insuficiente                                        â”‚  â”‚
â”‚   â”‚   â€¢ Baja coherencia entre decisiones y justificaciones               â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                             â”‚
â”‚                               â–¼                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ FASE 5: EvaluaciÃ³n de Dimensiones                                    â”‚  â”‚
â”‚   â”‚ _evaluate_dimensions(trace_sequence, reasoning)                      â”‚  â”‚
â”‚   â”‚   â€¢ DescomposiciÃ³n de Problemas                                       â”‚  â”‚
â”‚   â”‚   â€¢ AutorregulaciÃ³n y MetacogniciÃ³n                                  â”‚  â”‚
â”‚   â”‚   â€¢ Coherencia LÃ³gica                                                 â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                             â”‚
â”‚                               â–¼                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ FASE 6: CÃ¡lculo de EvaluaciÃ³n General                                â”‚  â”‚
â”‚   â”‚ _compute_overall_evaluation(dimensions)                              â”‚  â”‚
â”‚   â”‚   â€¢ Promedio de scores de dimensiones                                 â”‚  â”‚
â”‚   â”‚   â€¢ Mapeo a CompetencyLevel (INICIAL â†’ EXPERTO)                      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                             â”‚
â”‚                               â–¼                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ FASE 7: GeneraciÃ³n de Recomendaciones                                â”‚  â”‚
â”‚   â”‚ _identify_strengths_and_improvements()                               â”‚  â”‚
â”‚   â”‚ _generate_recommendations()                                          â”‚  â”‚
â”‚   â”‚   â€¢ Fortalezas detectadas                                             â”‚  â”‚
â”‚   â”‚   â€¢ Ãreas de mejora                                                   â”‚  â”‚
â”‚   â”‚   â€¢ Recomendaciones para estudiante                                   â”‚  â”‚
â”‚   â”‚   â€¢ Recomendaciones para docente                                      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                             â”‚
â”‚                               â–¼                                             â”‚
â”‚   SALIDA: EvaluationReport (Informe de EvaluaciÃ³n Cognitiva)              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. AnÃ¡lisis del Razonamiento

### 5.1 Modelo `ReasoningAnalysis`

```python
class ReasoningAnalysis(BaseModel):
    """AnÃ¡lisis del proceso de razonamiento"""

    # Camino cognitivo
    cognitive_path: List[str]           # Estados cognitivos transitados
    phases_completed: List[CognitivePhase]  # Fases completadas

    # MÃ©tricas de proceso
    strategy_changes: int               # Cambios de estrategia
    self_corrections: int               # Autocorrecciones realizadas
    ai_critiques: int                   # CrÃ­ticas a respuestas de IA

    # Coherencia
    coherence_score: float              # 0.0 - 1.0 (decisiones vs justificaciones)
    conceptual_errors: List[str]        # Errores conceptuales detectados
    logical_fallacies: List[str]        # Falacias lÃ³gicas detectadas

    # AutorregulaciÃ³n (Zimmerman)
    planning_quality: float             # Calidad de planificaciÃ³n (0.0 - 1.0)
    monitoring_evidence: List[str]      # Evidencias de automonitoreo
    self_explanation_quality: float     # Calidad de autoexplicaciÃ³n (0.0 - 1.0)
```

### 5.2 Fases Cognitivas Detectadas

```python
class CognitivePhase(str, Enum):
    """Fases del proceso cognitivo"""
    PLANIFICACION = "planificacion"     # PlanificaciÃ³n inicial
    EXPLORACION = "exploracion"         # ExploraciÃ³n conceptual
    IMPLEMENTACION = "implementacion"   # CodificaciÃ³n
    DEPURACION = "depuracion"          # Debug y correcciÃ³n
    VALIDACION = "validacion"          # Testing y verificaciÃ³n
    REFLEXION = "reflexion"            # MetacogniciÃ³n
```

### 5.3 DetecciÃ³n de Fases por Keywords

```python
phases_keywords = {
    CognitivePhase.PLANIFICACION: ["plan", "estrategia", "voy a", "primero"],
    CognitivePhase.EXPLORACION: ["entiendo", "quÃ© es", "cÃ³mo funciona"],
    CognitivePhase.IMPLEMENTACION: ["implemento", "cÃ³digo", "funciÃ³n"],
    CognitivePhase.DEPURACION: ["error", "bug", "falla", "no funciona"],
    CognitivePhase.VALIDACION: ["prueba", "test", "verifica", "funciona"],
    CognitivePhase.REFLEXION: ["me doy cuenta", "entiendo que", "aprendÃ­"]
}
```

---

## 6. Dimensiones de EvaluaciÃ³n

### 6.1 Las 3 Dimensiones Evaluadas

| DimensiÃ³n | DescripciÃ³n | Indicadores |
|-----------|-------------|-------------|
| **DescomposiciÃ³n de Problemas** | Capacidad de dividir problemas complejos en subproblemas manejables | `planning_quality` |
| **AutorregulaciÃ³n y MetacogniciÃ³n** | Capacidad de monitorear y ajustar el propio proceso de aprendizaje | `self_explanation_quality`, `monitoring_evidence` |
| **Coherencia LÃ³gica** | Coherencia entre razonamiento, decisiones y justificaciones | `coherence_score` |

### 6.2 Niveles de Competencia

```python
class CompetencyLevel(str, Enum):
    """Nivel de competencia alcanzado"""
    INICIAL = "inicial"           # < 5.0 puntos
    EN_DESARROLLO = "en_desarrollo"  # 5.0 - 6.9 puntos
    AUTONOMO = "autonomo"         # 7.0 - 8.4 puntos
    EXPERTO = "experto"           # >= 8.5 puntos
```

### 6.3 ConversiÃ³n Score â†’ Nivel

```python
def _score_to_level(self, score: float) -> CompetencyLevel:
    if score >= 8.5:
        return CompetencyLevel.EXPERTO
    elif score >= 7.0:
        return CompetencyLevel.AUTONOMO
    elif score >= 5.0:
        return CompetencyLevel.EN_DESARROLLO
    else:
        return CompetencyLevel.INICIAL
```

---

## 7. AnÃ¡lisis de Dependencia de IA

### 7.1 Concepto

El **ai_dependency_score** mide quÃ© tan dependiente es el estudiante de la asistencia de IA:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ESCALA DE DEPENDENCIA DE IA                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  0.0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1.0    â”‚
â”‚   â”‚                                                               â”‚     â”‚
â”‚   â”‚  AutÃ³nomo                    Moderado               Dependienteâ”‚     â”‚
â”‚   â”‚                                                               â”‚     â”‚
â”‚   â”‚  âœ… Trabaja                  âš ï¸ Balance              âŒ Delega â”‚     â”‚
â”‚   â”‚     independiente               saludable               todo   â”‚     â”‚
â”‚                                                                         â”‚
â”‚  InterpretaciÃ³n del score:                                              â”‚
â”‚  â€¢ < 0.3  â†’ âœ… Muy autÃ³nomo                                            â”‚
â”‚  â€¢ 0.3-0.6 â†’ âœ… Balance saludable                                       â”‚
â”‚  â€¢ 0.6-0.8 â†’ âš ï¸ Dependencia moderada-alta                              â”‚
â”‚  â€¢ > 0.8  â†’ âŒ Dependencia muy alta (alerta)                            â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 CÃ¡lculo del Score

El score se calcula como el promedio de `ai_involvement` de todas las trazas:

```python
# En TraceSequence._recalculate_ai_dependency()
if self.traces:
    total_involvement = sum(t.ai_involvement for t in self.traces)
    self.ai_dependency_score = total_involvement / len(self.traces)
else:
    self.ai_dependency_score = 0.0
```

### 7.3 Patrones de Uso de IA Analizados

```python
def _analyze_ai_usage_patterns(self, trace_sequence: TraceSequence) -> Dict[str, Any]:
    traces = trace_sequence.traces
    ai_interactions = [t for t in traces if t.interaction_type.value == "ai_response"]

    return {
        "total_ai_interactions": len(ai_interactions),
        "ai_interaction_rate": len(ai_interactions) / len(traces) if traces else 0,
        "delegation_attempts": 0,  # Calculado por el Tutor
    }
```

---

## 8. IdentificaciÃ³n de Riesgos Cognitivos

### 8.1 Riesgos Detectados AutomÃ¡ticamente

```python
def _identify_cognitive_risks(self, trace_sequence, reasoning) -> List[str]:
    risks = []

    # 1. Sin cambios de estrategia
    if reasoning.strategy_changes == 0:
        risks.append("No se observan cambios de estrategia (posible inflexibilidad)")

    # 2. Sin autocorrecciones
    if reasoning.self_corrections == 0:
        risks.append("No se observan autocorrecciones (falta de revisiÃ³n crÃ­tica)")

    # 3. PlanificaciÃ³n insuficiente
    if reasoning.planning_quality < 0.3:
        risks.append("PlanificaciÃ³n insuficiente")

    # 4. Baja coherencia
    if reasoning.coherence_score < 0.5:
        risks.append("Baja coherencia entre decisiones y justificaciones")

    return risks
```

### 8.2 RelaciÃ³n con AR-IA (Analista de Riesgos)

El E-IA-Proc detecta riesgos **cognitivos**, mientras que AR-IA analiza **5 dimensiones de riesgo**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DIVISIÃ“N DE RIESGOS EN EL ECOSISTEMA                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚   E-IA-Proc (Evaluador)                 AR-IA (Analista de Riesgos)       â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚
â”‚   â€¢ Inflexibilidad cognitiva            â€¢ RC: Riesgo Cognitivo             â”‚
â”‚   â€¢ Falta de revisiÃ³n crÃ­tica           â€¢ RE: Riesgo Ã‰tico                 â”‚
â”‚   â€¢ PlanificaciÃ³n insuficiente          â€¢ REp: Riesgo EpistÃ©mico           â”‚
â”‚   â€¢ Baja coherencia decisiÃ³n-           â€¢ RT: Riesgo TÃ©cnico               â”‚
â”‚     justificaciÃ³n                       â€¢ RG: Riesgo de Gobernanza         â”‚
â”‚                                                                           â”‚
â”‚   â–º Enfocado en PROCESO                 â–º Enfocado en COMPORTAMIENTO      â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. GeneraciÃ³n de RetroalimentaciÃ³n Formativa

### 9.1 MÃ©todo `generate_formative_feedback()`

```python
def generate_formative_feedback(
    self,
    evaluation_report: EvaluationReport,
    student_friendly: bool = True
) -> str:
```

Este mÃ©todo genera retroalimentaciÃ³n en **dos formatos**:

| Formato | MÃ©todo | Destinatario |
|---------|--------|--------------|
| `student_friendly=True` | `_generate_student_feedback()` | Estudiante |
| `student_friendly=False` | `_generate_teacher_feedback()` | Docente |

### 9.2 Estructura de RetroalimentaciÃ³n para Estudiante

```markdown
# ğŸ“Š RetroalimentaciÃ³n de tu Proceso de Aprendizaje

**Actividad**: prog2_tp1_colas
**Fecha**: 13/12/2025 10:30

---

## ğŸ¯ EvaluaciÃ³n General

**Nivel de Competencia**: EN_DESARROLLO
**Puntaje**: 6.5/10

**Â¿QuÃ© significa esto?** Vas por buen camino. Con mÃ¡s prÃ¡ctica alcanzarÃ¡s mayor autonomÃ­a.

---

## âœ… Tus Fortalezas

- Buena planificaciÃ³n inicial
- Capacidad de autocorrecciÃ³n

---

## ğŸ“ Ãreas para Mejorar

- Mejorar: Coherencia LÃ³gica

---

## ğŸ” AnÃ¡lisis de tu Proceso

### Fases que Completaste

- ğŸ“‹ PlanificaciÃ³n
- ğŸ” ExploraciÃ³n Conceptual
- ğŸ’» ImplementaciÃ³n

### Eventos Clave

- **Cambios de estrategia**: 2 âœ…
- **Autocorrecciones**: 1 âœ…
- **RevisiÃ³n crÃ­tica de IA**: 0 âš ï¸

ğŸ’¡ **Tip**: No encontramos evidencia de cuestionamiento de las respuestas de IA.

---

## ğŸ¤– Tu ColaboraciÃ³n con IA

**Nivel de asistencia de IA**: 45%

âœ… Balance saludable entre tu trabajo y la asistencia de IA.

---

## ğŸ¯ Recomendaciones para Seguir Mejorando

1. DedicÃ¡ mÃ¡s tiempo a planificar antes de implementar.
2. PracticÃ¡ la revisiÃ³n crÃ­tica: cuestionÃ¡ tus propias soluciones.

---

ğŸ¤– *RetroalimentaciÃ³n generada automÃ¡ticamente por E-IA-Proc basada en trazabilidad N4*
```

### 9.3 Estructura de RetroalimentaciÃ³n para Docente

```markdown
# ğŸ“Š Reporte de EvaluaciÃ³n de Proceso - Docente

**Estudiante**: student_123
**Actividad**: prog2_tp1_colas
**SesiÃ³n**: 550e8400-e29b-41d4-a716-446655440000
**Fecha**: 13/12/2025 10:30

---

## Resumen Ejecutivo

- **Nivel de Competencia**: EN_DESARROLLO
- **Puntaje General**: 6.5/10
- **Dependencia de IA**: 45%
- **Trazas Analizadas**: 1

---

## AnÃ¡lisis del Razonamiento

### MÃ©tricas Clave

| MÃ©trica | Valor | AnÃ¡lisis |
|---------|-------|----------|
| Cambios de estrategia | 2 | âœ… Flexibilidad cognitiva |
| Autocorrecciones | 1 | âœ… RevisiÃ³n crÃ­tica activa |
| CrÃ­tica a IA | 0 | âš ï¸ AceptaciÃ³n acrÃ­tica |
| Coherencia | 0.65 | âš ï¸ Baja coherencia |
| Calidad de planificaciÃ³n | 0.75 | âœ… Buena planificaciÃ³n |

---

## EvaluaciÃ³n por Dimensiones

### DescomposiciÃ³n de Problemas

- **Nivel**: autonomo
- **Score**: 7.5/10
- **Evidencias**: 3 registradas

### AutorregulaciÃ³n y MetacogniciÃ³n

- **Nivel**: en_desarrollo
- **Score**: 5.5/10
- **Evidencias**: 2 registradas

---

## âš ï¸ Riesgos Cognitivos Detectados

- Baja coherencia entre decisiones y justificaciones

---

## ğŸ“ Recomendaciones PedagÃ³gicas

- Revisar proceso completo documentado en trazabilidad N4
- Solicitar planificaciÃ³n explÃ­cita antes de codificar

---

## ğŸ“ Notas para EvaluaciÃ³n

Este reporte analiza el **proceso cognitivo**, no el producto final.
Considerar:

1. **EvaluaciÃ³n de proceso (60%) + producto (40%)**
2. Evidencia de trazabilidad N4 disponible para auditorÃ­a
3. Decisiones clave documentadas con justificaciÃ³n
4. Patrones de colaboraciÃ³n humano-IA

---

*Generado automÃ¡ticamente por E-IA-Proc (Evaluador de Procesos Cognitivos)*
```

---

## 10. InteracciÃ³n con Otros Agentes

### 10.1 Diagrama de InteracciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INTERACCIÃ“N E-IA-Proc CON OTROS AGENTES                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
â”‚   â”‚  TC-N4      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ENTRADA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚   â”‚ Trazabilidadâ”‚      TraceSequence con trazas cognitivas                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚          â”‚                                                                  â”‚
â”‚          â”‚ Proporciona: CognitiveTrace[], ai_dependency_score              â”‚
â”‚          â”‚              cognitive_path, strategy_changes                    â”‚
â”‚          â–¼                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
â”‚   â”‚  E-IA-Proc  â”‚â”€â”€â”€â”€ PROCESA â”€â”€â”€â”€â–º  EvaluationReport                     â”‚
â”‚   â”‚  (Evaluador)â”‚                                                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚          â”‚                                                                  â”‚
â”‚          â”‚ Consulta (si disponible):                                        â”‚
â”‚          â–¼                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
â”‚   â”‚ Git Integr. â”‚      code_evolution (commits)                            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
â”‚   â”‚   AR-IA     â”‚â—„â”€â”€â”€ COMPLEMENTA â”€â”€â”€                                      â”‚
â”‚   â”‚  (Riesgos)  â”‚      cognitive_risks se agregan al reporte               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
â”‚   â”‚ AIGateway   â”‚â—„â”€â”€â”€ ORQUESTA â”€â”€â”€                                         â”‚
â”‚   â”‚             â”‚      Invoca evaluate_process() cuando mode=EVALUATOR     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 Flujo de Datos

```
1. TC-N4 captura trazas durante toda la sesiÃ³n
                    â”‚
                    â–¼
2. Las trazas se agregan a TraceSequence
                    â”‚
                    â–¼
3. Al finalizar sesiÃ³n o solicitar evaluaciÃ³n:
   AIGateway invoca E-IA-Proc.evaluate_process(trace_sequence)
                    â”‚
                    â–¼
4. E-IA-Proc analiza las trazas y genera EvaluationReport
                    â”‚
                    â–¼
5. EvaluationRepository persiste el reporte en BD
                    â”‚
                    â–¼
6. El docente accede al reporte vÃ­a endpoint /evaluations
```

### 10.3 IntegraciÃ³n con ResponseGenerator

```python
# En backend/core/response_generator.py

class ResponseGenerator:
    def __init__(
        self,
        tutor: TutorCognitivoAgent,
        evaluator: ProcessEvaluatorAgent,  # â—„â”€â”€ E-IA-Proc inyectado
        llm_provider: LLMProvider,
        config: Optional[Dict[str, Any]] = None
    ):
        self.tutor = tutor
        self.evaluator = evaluator
        ...

    def _generate_evaluation_response(
        self,
        session_id: str,
        context: Optional[Dict[str, Any]]
    ) -> str:
        """Genera respuesta de evaluaciÃ³n usando E-IA-Proc"""
        evaluation = self.evaluator.evaluate_process(
            session_id=session_id,
            context=context or {}
        )
        return evaluation
```

---

## 11. InteracciÃ³n con Base de Datos

### 11.1 Tablas Utilizadas

```sql
-- TABLA PRINCIPAL: evaluations
CREATE TABLE evaluations (
    id VARCHAR(36) PRIMARY KEY,
    session_id VARCHAR(36) NOT NULL REFERENCES sessions(id) ON DELETE CASCADE,
    student_id VARCHAR(100) NOT NULL,
    activity_id VARCHAR(100) NOT NULL,

    -- EvaluaciÃ³n general
    overall_competency_level VARCHAR(50) NOT NULL,  -- CompetencyLevel
    overall_score FLOAT NOT NULL CHECK (overall_score >= 0 AND overall_score <= 10),

    -- Dimensiones (JSON)
    dimensions JSON DEFAULT '[]',

    -- RetroalimentaciÃ³n (JSON)
    key_strengths JSON DEFAULT '[]',
    improvement_areas JSON DEFAULT '[]',
    recommendations JSON DEFAULT '{}',  -- {"student": [], "teacher": []}

    -- AnÃ¡lisis (JSON)
    reasoning_analysis JSON,
    git_analysis JSON,
    ai_dependency_score FLOAT DEFAULT 0.0 CHECK (ai_dependency_score >= 0 AND ai_dependency_score <= 1),
    ai_dependency_metrics JSON,

    -- Timestamps
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Ãndices para consultas frecuentes
CREATE INDEX idx_eval_student_activity ON evaluations(student_id, activity_id);
CREATE INDEX idx_competency_score ON evaluations(overall_competency_level, overall_score);
CREATE INDEX idx_eval_student_created ON evaluations(student_id, created_at);
CREATE INDEX idx_eval_session_created ON evaluations(session_id, created_at);
```

### 11.2 Tablas de Lectura (Input)

```sql
-- cognitive_traces: Trazas que se analizan
CREATE TABLE cognitive_traces (
    id VARCHAR(36) PRIMARY KEY,
    session_id VARCHAR(36) NOT NULL REFERENCES sessions(id) ON DELETE CASCADE,
    student_id VARCHAR(100) NOT NULL,
    activity_id VARCHAR(100) NOT NULL,

    trace_level VARCHAR(50) NOT NULL,     -- n1_superficial, n2_tecnico, n3_interaccional, n4_cognitivo
    interaction_type VARCHAR(50) NOT NULL, -- student_prompt, ai_response, etc.
    content TEXT NOT NULL,
    context JSON,

    -- N4: AnÃ¡lisis cognitivo
    cognitive_state VARCHAR(50),
    cognitive_intent VARCHAR(100),
    decision_justification TEXT,
    alternatives_considered JSON,
    ai_involvement FLOAT DEFAULT 0.0,

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- trace_sequences: Secuencias de trazas analizadas
CREATE TABLE trace_sequences (
    id VARCHAR(36) PRIMARY KEY,
    session_id VARCHAR(36) REFERENCES sessions(id),
    student_id VARCHAR(100) NOT NULL,
    activity_id VARCHAR(100) NOT NULL,

    trace_ids JSON DEFAULT '[]',          -- IDs de trazas en la secuencia
    reasoning_path JSON DEFAULT '[]',     -- Camino cognitivo reconstruido
    strategy_changes JSON DEFAULT '[]',
    ai_dependency_score FLOAT DEFAULT 0.0,

    start_time TIMESTAMP,
    end_time TIMESTAMP,

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- sessions: Sesiones de aprendizaje
CREATE TABLE sessions (
    id VARCHAR(36) PRIMARY KEY,
    student_id VARCHAR(100) NOT NULL,
    activity_id VARCHAR(100) NOT NULL,
    mode VARCHAR(50) NOT NULL,            -- TUTOR, EVALUATOR, SIMULATOR, etc.
    status VARCHAR(50) DEFAULT 'active',

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 11.3 Modelo ORM: `EvaluationDB`

```python
# backend/database/models.py

class EvaluationDB(Base, BaseModel):
    """Database model for process evaluations"""

    __tablename__ = "evaluations"

    session_id = Column(String(36), ForeignKey("sessions.id", ondelete="CASCADE"), nullable=False, index=True)
    student_id = Column(String(100), nullable=False, index=True)
    activity_id = Column(String(100), nullable=False)

    # Overall assessment
    overall_competency_level = Column(String(50), nullable=False)  # CompetencyLevel
    overall_score = Column(Float, nullable=False)  # 0.0 to 10.0

    # Dimensions (stored as JSON for flexibility)
    dimensions = Column(JSON, default=list)  # List of DimensionEvaluation dicts

    # Feedback
    key_strengths = Column(JSON, default=list)
    improvement_areas = Column(JSON, default=list)
    recommendations = Column(JSON, default=list)

    # Analysis metadata
    reasoning_analysis = Column(JSON, nullable=True)
    git_analysis = Column(JSON, nullable=True)
    ai_dependency_score = Column(Float, default=0.0)
    ai_dependency_metrics = Column(JSON, nullable=True)

    # Relationship
    session = relationship("SessionDB", back_populates="evaluations")
```

### 11.4 Repository: `EvaluationRepository`

```python
# backend/database/repositories.py

class EvaluationRepository:
    """Repository for evaluation operations"""

    def __init__(self, db_session: Session):
        self.db = db_session

    def create(self, evaluation: EvaluationReport) -> EvaluationDB:
        """Crea una nueva evaluaciÃ³n"""
        # Combinar recomendaciones en estructura JSON Ãºnica
        recommendations = {
            "student": evaluation.recommendations_student,
            "teacher": evaluation.recommendations_teacher,
        }

        db_evaluation = EvaluationDB(
            id=str(uuid4()),
            session_id=evaluation.session_id,
            student_id=evaluation.student_id,
            activity_id=evaluation.activity_id,
            overall_competency_level=evaluation.overall_competency_level.value,
            overall_score=evaluation.overall_score,
            dimensions=[d.model_dump() for d in evaluation.dimensions],
            key_strengths=evaluation.key_strengths,
            improvement_areas=evaluation.improvement_areas,
            recommendations=recommendations,
            reasoning_analysis=evaluation.reasoning_analysis.model_dump() if evaluation.reasoning_analysis else {},
            git_analysis=evaluation.git_analysis.model_dump() if evaluation.git_analysis else {},
            ai_dependency_metrics={
                "score": evaluation.ai_dependency_score,
                "usage_patterns": evaluation.ai_usage_patterns,
            },
        )
        self.db.add(db_evaluation)
        self.db.commit()
        self.db.refresh(db_evaluation)
        return db_evaluation

    def get_by_id(self, evaluation_id: str) -> Optional[EvaluationDB]:
        """Obtiene evaluaciÃ³n por ID"""
        return self.db.query(EvaluationDB).filter(EvaluationDB.id == evaluation_id).first()

    def get_by_session(self, session_id: str, limit: int = 100, offset: int = 0) -> List[EvaluationDB]:
        """Obtiene todas las evaluaciones de una sesiÃ³n"""
        return (
            self.db.query(EvaluationDB)
            .filter(EvaluationDB.session_id == session_id)
            .order_by(desc(EvaluationDB.created_at))
            .limit(limit)
            .offset(offset)
            .all()
        )

    def get_by_student(self, student_id: str, limit: int = 100, offset: int = 0) -> List[EvaluationDB]:
        """Obtiene todas las evaluaciones de un estudiante"""
        return (
            self.db.query(EvaluationDB)
            .filter(EvaluationDB.student_id == student_id)
            .order_by(desc(EvaluationDB.created_at))
            .limit(limit)
            .offset(offset)
            .all()
        )

    def get_latest_by_session_ids(self, session_ids: List[str]) -> Dict[str, EvaluationDB]:
        """Batch loading: obtiene la Ãºltima evaluaciÃ³n de mÃºltiples sesiones"""
        # Previene N+1 queries
        ...
```

---

## 12. Endpoint REST de EvaluaciÃ³n

### 12.1 Router: `/evaluations`

```python
# backend/api/routers/evaluations.py

router = APIRouter(prefix="/evaluations", tags=["Evaluations"])

@router.post("/{session_id}/generate", response_model=APIResponse[ProcessEvaluation])
async def generate_process_evaluation(
    session_id: str,
    session_repo: SessionRepository = Depends(get_session_repository),
    trace_repo: TraceRepository = Depends(get_trace_repository),
    llm_provider: LLMProvider = Depends(get_llm_provider),
    current_user: dict = Depends(get_current_user),  # Requiere autenticaciÃ³n
) -> APIResponse[ProcessEvaluation]:
    """
    Genera una evaluaciÃ³n cognitiva completa basada en el proceso observado

    Analiza:
    - PlanificaciÃ³n: CÃ³mo el estudiante aborda problemas nuevos
    - EjecuciÃ³n: Calidad de implementaciÃ³n y estrategias
    - Debugging: Habilidad para diagnosticar y corregir errores
    - ReflexiÃ³n: MetacogniciÃ³n y aprendizaje de errores
    - AutonomÃ­a: Independencia vs delegaciÃ³n a IA

    Returns:
        ProcessEvaluation con puntuaciones 0-10 en cada dimensiÃ³n
    """
```

### 12.2 Flujo del Endpoint

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLUJO: POST /evaluations/{session_id}/generate            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   1. VERIFICAR SESIÃ“N                                                        â”‚
â”‚      session = session_repo.get_by_id(session_id)                           â”‚
â”‚      if not session: raise SessionNotFoundError                              â”‚
â”‚                                                                              â”‚
â”‚   2. OBTENER TRAZAS COGNITIVAS                                              â”‚
â”‚      traces = trace_repo.get_by_session(session_id)                         â”‚
â”‚      if not traces: raise HTTPException(404, "No traces found")             â”‚
â”‚                                                                              â”‚
â”‚   3. CONSTRUIR DATOS PARA LLM                                               â”‚
â”‚      traces_data = [                                                         â”‚
â”‚          {                                                                   â”‚
â”‚              "input": trace.content,                                         â”‚
â”‚              "output": trace.context.get("ai_response", ""),                â”‚
â”‚              "ai_involvement": trace.ai_involvement,                         â”‚
â”‚              "timestamp": trace.timestamp.isoformat()                        â”‚
â”‚          }                                                                   â”‚
â”‚          for trace in traces[:20]  # Limitar a Ãºltimas 20                   â”‚
â”‚      ]                                                                       â”‚
â”‚                                                                              â”‚
â”‚   4. CONSTRUIR PROMPT PARA OLLAMA                                           â”‚
â”‚      prompt = f"""                                                           â”‚
â”‚      Eres un evaluador experto en cogniciÃ³n y aprendizaje.                  â”‚
â”‚      Analiza la sesiÃ³n y evalÃºa el PROCESO en 5 dimensiones:                â”‚
â”‚      1. PLANNING (PlanificaciÃ³n)                                             â”‚
â”‚      2. EXECUTION (EjecuciÃ³n)                                                â”‚
â”‚      3. DEBUGGING (DepuraciÃ³n)                                               â”‚
â”‚      4. REFLECTION (ReflexiÃ³n)                                               â”‚
â”‚      5. AUTONOMY (AutonomÃ­a)                                                 â”‚
â”‚      ...                                                                     â”‚
â”‚      """                                                                     â”‚
â”‚                                                                              â”‚
â”‚   5. LLAMAR A OLLAMA                                                         â”‚
â”‚      llm_response = await llm_provider.generate(                            â”‚
â”‚          messages=[LLMMessage(role=LLMRole.USER, content=prompt)],          â”‚
â”‚          temperature=0.3  # Baja para respuestas consistentes               â”‚
â”‚      )                                                                       â”‚
â”‚                                                                              â”‚
â”‚   6. PARSEAR RESPUESTA JSON                                                 â”‚
â”‚      eval_data = json.loads(llm_response.content)                           â”‚
â”‚      # Validar scores (0-10), levels (novice/competent/proficient/expert)   â”‚
â”‚                                                                              â”‚
â”‚   7. CONSTRUIR ProcessEvaluation                                            â”‚
â”‚      evaluation = ProcessEvaluation(                                         â”‚
â”‚          session_id=session_id,                                              â”‚
â”‚          student_id=session.student_id,                                      â”‚
â”‚          planning=DimensionScore(...),                                       â”‚
â”‚          execution=DimensionScore(...),                                      â”‚
â”‚          ...                                                                 â”‚
â”‚      )                                                                       â”‚
â”‚                                                                              â”‚
â”‚   8. RETORNAR RESPUESTA                                                     â”‚
â”‚      return APIResponse(success=True, data=evaluation)                      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12.3 Schema de Respuesta

```python
class ProcessEvaluation(BaseModel):
    """EvaluaciÃ³n completa del proceso cognitivo del estudiante"""
    session_id: str
    student_id: str
    activity_id: str

    # 5 dimensiones del proceso
    planning: DimensionScore
    execution: DimensionScore
    debugging: DimensionScore
    reflection: DimensionScore
    autonomy: DimensionScore

    # Patrones generales
    autonomy_level: str  # low/medium/high
    metacognition_score: float  # 0-10
    delegation_ratio: float  # 0-1 (% de delegaciÃ³n a IA)

    # Evidencia general
    overall_feedback: str
    generated_at: datetime
```

---

## 13. Modelo Pydantic: `EvaluationReport`

### 13.1 Estructura Completa

```python
# backend/models/evaluation.py

class EvaluationReport(BaseModel):
    """Informe de EvaluaciÃ³n Cognitiva (IEC) generado por E-IA-Proc"""

    # Identificadores
    id: str
    session_id: str
    created_at: datetime = Field(default_factory=datetime.now, alias="timestamp")
    student_id: str
    activity_id: str

    # AnÃ¡lisis principal
    reasoning_analysis: Optional[ReasoningAnalysis]
    git_analysis: Optional[GitAnalysis]

    # Dimensiones evaluadas
    dimensions: List[EvaluationDimension] = []

    # Dependencia de IA
    ai_dependency_score: float  # 0-1
    ai_usage_patterns: Dict[str, Any] = {}
    reasoning_map: Dict[str, Any] = {}

    # Riesgos cognitivos
    cognitive_risks: List[str] = []

    # EvaluaciÃ³n general
    overall_competency_level: CompetencyLevel
    overall_score: float  # 0-10

    # RetroalimentaciÃ³n
    key_strengths: List[str] = []
    improvement_areas: List[str] = []
    recommendations_student: List[str] = []
    recommendations_teacher: List[str] = []

    # Metadata
    evaluator_version: str = "E-IA-Proc-v1.0"
    trace_sequences_analyzed: int = 0
```

### 13.2 Submodelos

```python
class EvaluationDimension(BaseModel):
    """DimensiÃ³n de evaluaciÃ³n"""
    name: str                              # "DescomposiciÃ³n de Problemas"
    description: str                       # DescripciÃ³n de la dimensiÃ³n
    level: CompetencyLevel                 # INICIAL, EN_DESARROLLO, AUTONOMO, EXPERTO
    score: float                           # 0-10
    evidence: List[str] = []               # Evidencias observadas
    strengths: List[str] = []              # Fortalezas en esta dimensiÃ³n
    weaknesses: List[str] = []             # Debilidades
    recommendations: List[str] = []        # Recomendaciones especÃ­ficas


class GitAnalysis(BaseModel):
    """AnÃ¡lisis de evoluciÃ³n del cÃ³digo vÃ­a Git"""
    total_commits: int = 0
    commit_messages_quality: float  # 0-1
    suspicious_jumps: List[str] = []       # Saltos abruptos (posible cÃ³digo copiado)
    evolution_coherence: float  # 0-1
    traces_linked: int = 0                 # Commits vinculados a trazas N4
```

---

## 14. ValidaciÃ³n de Respuestas LLM

### 14.1 Problema

El LLM (Ollama/Phi-3) puede retornar valores fuera de rango:
- Scores como 15.5 o -2 (fuera de 0-10)
- Niveles invÃ¡lidos como "super-expert" o "invalid"

### 14.2 SoluciÃ³n: Funciones de ValidaciÃ³n

```python
# backend/api/routers/evaluations.py

VALID_LEVELS = {"novice", "competent", "proficient", "expert"}
DEFAULT_LEVEL = "competent"
MIN_SCORE = 0.0
MAX_SCORE = 10.0

def _validate_score(score: float) -> float:
    """Clamp score to valid range 0-10"""
    try:
        score = float(score)
    except (TypeError, ValueError):
        return 5.0  # Default if not a valid number
    return max(MIN_SCORE, min(MAX_SCORE, score))


def _validate_level(level: str) -> str:
    """Validate level is a valid value"""
    if not isinstance(level, str):
        return DEFAULT_LEVEL

    level_lower = level.lower().strip()

    # Direct match
    if level_lower in VALID_LEVELS:
        return level_lower

    # Common aliases/misspellings
    level_aliases = {
        "beginner": "novice",
        "developing": "novice",
        "basic": "novice",
        "intermediate": "competent",
        "medium": "competent",
        "advanced": "proficient",
        "skilled": "proficient",
        "master": "expert",
        "excellent": "expert",
    }

    if level_lower in level_aliases:
        return level_aliases[level_lower]

    logger.warning(f"Invalid level '{level}' from LLM, defaulting to '{DEFAULT_LEVEL}'")
    return DEFAULT_LEVEL
```

---

## 15. Escalas de PuntuaciÃ³n

### 15.1 Escalas Utilizadas

| Campo | Escala | Uso |
|-------|--------|-----|
| `overall_score` | 0-10 | PuntuaciÃ³n general del estudiante |
| `dimension.score` | 0-10 | PuntuaciÃ³n por dimensiÃ³n |
| `ai_dependency_score` | 0-1 | Nivel de dependencia de IA |
| `coherence_score` | 0-1 | Coherencia decisiÃ³n-justificaciÃ³n |
| `planning_quality` | 0-1 | Calidad de planificaciÃ³n |
| `self_explanation_quality` | 0-1 | Calidad de autoexplicaciÃ³n |

### 15.2 Importante (Fix Cortez8)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ESCALAS DE PUNTUACIÃ“N - CONSISTENCIA ORM vs PYDANTIC                         â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                               â•‘
â•‘  FIX 1.1-1.6 Cortez8: Las escalas fueron unificadas:                         â•‘
â•‘                                                                               â•‘
â•‘  â€¢ overall_score:      0-10 (era 0-1, ahora corregido)                       â•‘
â•‘  â€¢ dimension.score:    0-10 (era 0-1, ahora corregido)                       â•‘
â•‘  â€¢ ai_dependency_score: 0-1 (siempre fue asÃ­, sin cambios)                   â•‘
â•‘                                                                               â•‘
â•‘  El ORM (EvaluationDB) y el Pydantic (EvaluationReport) ahora usan las       â•‘
â•‘  mismas escalas para evitar confusiÃ³n.                                        â•‘
â•‘                                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 16. Resumen de MÃ©todos Principales

### 16.1 Clase `EvaluadorProcesosAgent`

| MÃ©todo | PropÃ³sito | Input | Output |
|--------|-----------|-------|--------|
| `evaluate_process()` | Pipeline principal de evaluaciÃ³n | `TraceSequence`, `code_evolution` | `EvaluationReport` |
| `_analyze_reasoning()` | Analiza camino cognitivo | `TraceSequence` | `ReasoningAnalysis` |
| `_identify_phases()` | Identifica fases completadas | `List[CognitiveTrace]` | `List[CognitivePhase]` |
| `_calculate_coherence()` | Calcula coherencia decisiÃ³n-justificaciÃ³n | `List[CognitiveTrace]` | `float` (0-1) |
| `_detect_conceptual_errors()` | Detecta errores conceptuales | `List[CognitiveTrace]` | `List[str]` |
| `_analyze_git_evolution()` | Analiza commits Git | `code_evolution`, `TraceSequence` | `GitAnalysis` |
| `_calculate_ai_dependency()` | Obtiene score de dependencia IA | `TraceSequence` | `float` (0-1) |
| `_identify_cognitive_risks()` | Identifica riesgos cognitivos | `TraceSequence`, `ReasoningAnalysis` | `List[str]` |
| `_evaluate_dimensions()` | EvalÃºa 3 dimensiones | `TraceSequence`, `ReasoningAnalysis` | `List[EvaluationDimension]` |
| `_score_to_level()` | Convierte score a nivel | `float` | `CompetencyLevel` |
| `_compute_overall_evaluation()` | Calcula evaluaciÃ³n general | `List[EvaluationDimension]` | `(CompetencyLevel, float)` |
| `_generate_recommendations()` | Genera recomendaciones | dimensiones, reasoning, risks | `(List[str], List[str])` |
| `generate_formative_feedback()` | Genera retroalimentaciÃ³n | `EvaluationReport`, `student_friendly` | `str` (Markdown) |

---

## 17. Diagrama de Flujo Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              FLUJO COMPLETO E-IA-Proc                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                             â”‚
â”‚   [Estudiante trabaja en actividad]                                                         â”‚
â”‚                â”‚                                                                            â”‚
â”‚                â–¼                                                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                              TC-N4 (Trazabilidad)                                  â”‚    â”‚
â”‚   â”‚                                                                                     â”‚    â”‚
â”‚   â”‚   Captura continua de:                                                              â”‚    â”‚
â”‚   â”‚   â€¢ student_prompt, ai_response                                                     â”‚    â”‚
â”‚   â”‚   â€¢ cognitive_state, cognitive_intent                                               â”‚    â”‚
â”‚   â”‚   â€¢ decision_justification, alternatives_considered                                 â”‚    â”‚
â”‚   â”‚   â€¢ ai_involvement (0-1)                                                            â”‚    â”‚
â”‚   â”‚                                                                                     â”‚    â”‚
â”‚   â”‚   Almacena en: cognitive_traces (PostgreSQL)                                        â”‚    â”‚
â”‚   â”‚   Agrupa en: TraceSequence                                                          â”‚    â”‚
â”‚   â”‚                                                                                     â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                â”‚                                                                            â”‚
â”‚                â–¼                                                                            â”‚
â”‚   [SesiÃ³n finaliza o docente solicita evaluaciÃ³n]                                          â”‚
â”‚                â”‚                                                                            â”‚
â”‚                â–¼                                                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                    POST /evaluations/{session_id}/generate                         â”‚    â”‚
â”‚   â”‚                                                                                     â”‚    â”‚
â”‚   â”‚   1. Verificar sesiÃ³n existe                                                        â”‚    â”‚
â”‚   â”‚   2. Obtener trazas de la sesiÃ³n                                                    â”‚    â”‚
â”‚   â”‚   3. Construir TraceSequence                                                        â”‚    â”‚
â”‚   â”‚                                                                                     â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                â”‚                                                                            â”‚
â”‚                â–¼                                                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                         E-IA-Proc.evaluate_process()                               â”‚    â”‚
â”‚   â”‚                                                                                     â”‚    â”‚
â”‚   â”‚   FASE 1: _analyze_reasoning()                                                      â”‚    â”‚
â”‚   â”‚           â””â”€â”€ cognitive_path, phases, strategy_changes, coherence                   â”‚    â”‚
â”‚   â”‚                                                                                     â”‚    â”‚
â”‚   â”‚   FASE 2: _analyze_git_evolution() [si disponible]                                 â”‚    â”‚
â”‚   â”‚           â””â”€â”€ commits, quality, suspicious_jumps                                    â”‚    â”‚
â”‚   â”‚                                                                                     â”‚    â”‚
â”‚   â”‚   FASE 3: _calculate_ai_dependency()                                               â”‚    â”‚
â”‚   â”‚           â””â”€â”€ ai_dependency_score (0-1)                                             â”‚    â”‚
â”‚   â”‚                                                                                     â”‚    â”‚
â”‚   â”‚   FASE 4: _identify_cognitive_risks()                                              â”‚    â”‚
â”‚   â”‚           â””â”€â”€ riesgos: inflexibilidad, falta revisiÃ³n, baja coherencia              â”‚    â”‚
â”‚   â”‚                                                                                     â”‚    â”‚
â”‚   â”‚   FASE 5: _evaluate_dimensions()                                                   â”‚    â”‚
â”‚   â”‚           â””â”€â”€ DescomposiciÃ³n, AutorregulaciÃ³n, Coherencia                           â”‚    â”‚
â”‚   â”‚                                                                                     â”‚    â”‚
â”‚   â”‚   FASE 6: _compute_overall_evaluation()                                            â”‚    â”‚
â”‚   â”‚           â””â”€â”€ overall_score (0-10), CompetencyLevel                                 â”‚    â”‚
â”‚   â”‚                                                                                     â”‚    â”‚
â”‚   â”‚   FASE 7: _generate_recommendations()                                              â”‚    â”‚
â”‚   â”‚           â””â”€â”€ recomendaciones para estudiante y docente                             â”‚    â”‚
â”‚   â”‚                                                                                     â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                â”‚                                                                            â”‚
â”‚                â–¼                                                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                              EvaluationReport                                       â”‚    â”‚
â”‚   â”‚                                                                                     â”‚    â”‚
â”‚   â”‚   {                                                                                 â”‚    â”‚
â”‚   â”‚     "id": "eval_xxx",                                                               â”‚    â”‚
â”‚   â”‚     "session_id": "550e8400-...",                                                   â”‚    â”‚
â”‚   â”‚     "student_id": "student_123",                                                    â”‚    â”‚
â”‚   â”‚     "overall_score": 6.5,                                                           â”‚    â”‚
â”‚   â”‚     "overall_competency_level": "en_desarrollo",                                    â”‚    â”‚
â”‚   â”‚     "ai_dependency_score": 0.45,                                                    â”‚    â”‚
â”‚   â”‚     "dimensions": [...],                                                            â”‚    â”‚
â”‚   â”‚     "cognitive_risks": ["Baja coherencia..."],                                      â”‚    â”‚
â”‚   â”‚     "key_strengths": ["Buena planificaciÃ³n"],                                       â”‚    â”‚
â”‚   â”‚     "improvement_areas": ["Mejorar: Coherencia LÃ³gica"],                            â”‚    â”‚
â”‚   â”‚     "recommendations_student": [...],                                               â”‚    â”‚
â”‚   â”‚     "recommendations_teacher": [...]                                                â”‚    â”‚
â”‚   â”‚   }                                                                                 â”‚    â”‚
â”‚   â”‚                                                                                     â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                â”‚                                                                            â”‚
â”‚                â–¼                                                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                         EvaluationRepository.create()                              â”‚    â”‚
â”‚   â”‚                                                                                     â”‚    â”‚
â”‚   â”‚   Persiste en PostgreSQL tabla `evaluations`                                        â”‚    â”‚
â”‚   â”‚                                                                                     â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                â”‚                                                                            â”‚
â”‚                â–¼                                                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                        generate_formative_feedback()                               â”‚    â”‚
â”‚   â”‚                                                                                     â”‚    â”‚
â”‚   â”‚   Si student_friendly=True  â†’ RetroalimentaciÃ³n para estudiante (Markdown)         â”‚    â”‚
â”‚   â”‚   Si student_friendly=False â†’ Reporte tÃ©cnico para docente (Markdown)              â”‚    â”‚
â”‚   â”‚                                                                                     â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                â”‚                                                                            â”‚
â”‚                â–¼                                                                            â”‚
â”‚   [Docente revisa y toma decisiÃ³n final de evaluaciÃ³n]                                     â”‚
â”‚                                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 18. Conclusiones

### 18.1 Rol del E-IA-Proc en el Ecosistema

| Aspecto | DescripciÃ³n |
|---------|-------------|
| **PropÃ³sito** | Evaluar el PROCESO cognitivo, no el producto final |
| **Input** | TraceSequence (trazas N4 capturadas por TC-N4) |
| **Output** | EvaluationReport con anÃ¡lisis, dimensiones, riesgos y recomendaciones |
| **DecisiÃ³n Final** | SIEMPRE del docente humano (E-IA-Proc solo genera evidencia) |

### 18.2 Diferencias con Evaluadores Tradicionales

| Aspecto | Evaluador Tradicional | E-IA-Proc |
|---------|----------------------|-----------|
| **Foco** | CÃ³digo final (producto) | Proceso cognitivo |
| **Datos** | CÃ³digo entregado | Trazas N4 del camino completo |
| **MÃ©tricas** | Funcionalidad, style, tests | PlanificaciÃ³n, autorregulaciÃ³n, coherencia |
| **Uso de IA** | No considerado | ai_dependency_score (0-1) |
| **Transparencia** | "Nota: 7.5" | Evidencia completa trazable |

### 18.3 IntegraciÃ³n con Otros Agentes

```
TC-N4 â”€â”€â–º E-IA-Proc â”€â”€â–º EvaluationReport â”€â”€â–º Docente
  â”‚                           â”‚
  â”‚                           â–¼
  â”‚                    RetroalimentaciÃ³n
  â”‚                    formativa al estudiante
  â”‚
  â””â”€â”€â–º AR-IA â”€â”€â–º Riesgos complementarios (5D)
```

---

## 19. Referencias

- **Archivo principal**: `backend/agents/evaluator.py`
- **Modelos**: `backend/models/evaluation.py`
- **Schemas API**: `backend/api/schemas/evaluation.py`
- **Router**: `backend/api/routers/evaluations.py`
- **ORM**: `backend/database/models.py` â†’ `EvaluationDB`
- **Repository**: `backend/database/repositories.py` â†’ `EvaluationRepository`
- **Base teÃ³rica**: Zimmerman, B. J. (2002). Becoming a Self-Regulated Learner: An Overview.

---

*DocumentaciÃ³n generada por anÃ¡lisis de cÃ³digo del sistema AI-Native MVP*
*Fecha: 13 de Diciembre de 2025*